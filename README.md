# **Auth Microservice**

–≠—Ç–æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ email/–ø–∞—Ä–æ–ª—é –∏ —á–µ—Ä–µ–∑ **OAuth (–Ø–Ω–¥–µ–∫—Å)**, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞.  

## **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**
- **Python 3.12**  
- **FastAPI** ‚Äî –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫  
- **SQLAlchemy** ‚Äî ORM  
- **PostgreSQL** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö  
- **Redis** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤  
- **Alembic** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö  
- **Docker & Docker Compose**  
- **Pytest** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  
- **Authlib** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OAuth  
- **Uvicorn** ‚Äî ASGI-—Å–µ—Ä–≤–µ—Ä  

## **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**
```plaintext
‚îú‚îÄ‚îÄ alembic/                     # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ nginx/                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NGINX
‚îú‚îÄ‚îÄ src/                          # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/                   # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/              # Pydantic-—Å—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py               # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ me.py                 # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ oauth.py              # OAuth-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permission.py         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roles.py              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ core/                     # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exception_handlers.py # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.py             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ db/                       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ Redis
‚îÇ   ‚îú‚îÄ‚îÄ domain/                   # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Å—É—â–Ω–æ—Å—Ç–∏, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # –°–µ—Ä–≤–∏—Å—ã (Auth, OAuth, Session –∏ —Ç. –¥.)
‚îÇ   ‚îú‚îÄ‚îÄ tests/                    # –¢–µ—Å—Ç—ã (—é–Ω–∏—Ç –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
‚îú‚îÄ‚îÄ .env.example                  # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
‚îú‚îÄ‚îÄ docker-compose.yml             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ Dockerfile                     # –û–±—Ä–∞–∑ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ‚îÄ Makefile                        # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ requirements.txt                # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ README.md                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
```

## **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫**
### **1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
cp .env.example .env
```
–ó–∞–ø–æ–ª–Ω–∏ `.env` —Å–≤–æ–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

### **2. –ó–∞–ø—É—Å–∫ –≤ Docker**
```bash
docker-compose up --build
```

### **3. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ**
```bash
python -m venv .venv
source .venv/bin/activate  # –î–ª—è Linux/Mac
.venv\Scripts\activate     # –î–ª—è Windows
pip install -r requirements.txt
alembic upgrade head       # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
uvicorn src.main:app --reload
```

---

## **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**
### **1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`/api/v1/auth`)**
| –ú–µ—Ç–æ–¥  | –≠–Ω–¥–ø–æ–∏–Ω—Ç          | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------------------|----------|
| `POST` | `/register/`     | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `POST` | `/login/`        | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `POST` | `/logout/`       | –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã |
| `POST` | `/refresh/`      | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ |
| `POST` | `/logout-others/`| –í—ã—Ö–æ–¥ –∏–∑ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π |

---

### **2. –ü—Ä–æ—Ñ–∏–ª—å (`/api/v1/me`)**
| –ú–µ—Ç–æ–¥  | –≠–Ω–¥–ø–æ–∏–Ω—Ç                     | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------------------------|----------|
| `GET`  | `/`                         | –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è |
| `GET`  | `/{uuid}/sessions/`         | –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ |
| `POST` | `/change-password/`         | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è |

---

### **3. OAuth (–Ø–Ω–¥–µ–∫—Å) (`/api/v1/oauth`)**
| –ú–µ—Ç–æ–¥  | –≠–Ω–¥–ø–æ–∏–Ω—Ç               | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------------------|----------|
| `GET`  | `/yandex/login`       | –ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| `GET`  | `/yandex/callback`    | Callback –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |

---

### **4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ (`/api/v1/permissions`)**
| –ú–µ—Ç–æ–¥  | –≠–Ω–¥–ø–æ–∏–Ω—Ç            | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------------------|----------|
| `GET`  | `/`                | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤ |
| `GET`  | `/{slug}/`         | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–æ |
| `POST` | `/`                | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–æ |
| `PATCH`| `/{slug}/`         | –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–æ |
| `DELETE` | `/{slug}/`       | –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–æ |

---

### **5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ (`/api/v1/roles`)**
| –ú–µ—Ç–æ–¥  | –≠–Ω–¥–ø–æ–∏–Ω—Ç                  | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------------------------|----------|
| `GET`  | `/`                      | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π |
| `GET`  | `/{slug}/`               | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–æ–ª—å |
| `POST` | `/`                      | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å |
| `PATCH`| `/{slug}/`               | –ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å |
| `DELETE` | `/{slug}/`             | –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å |
| `POST` | `/add-role-to-user/`     | –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| `POST` | `/delete-role-from-user/` | –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

---

## **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
pytest
```
–¢–µ—Å—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `tests/unit/`.

## üë®‚Äçüíª **–ê–≤—Ç–æ—Ä**

[–ü–∞–≤–µ–ª –ì–ª–∞–≤–∞–Ω / GitHub –ø—Ä–æ—Ñ–∏–ª—å]\
‚úâÔ∏è Email: pglavan1998@gmail.com\
üöÄ GitHub: https://github.com/suvorovjr\
